using System.Text;

namespace ModularPipelines.OptionsGenerator.Generators;

/// <summary>
/// Shared utilities for code generators.
/// Centralizes common functionality to avoid DRY violations.
/// </summary>
public static class GeneratorUtils
{
    /// <summary>
    /// Escapes text for use in XML documentation comments.
    /// </summary>
    public static string EscapeXmlComment(string text)
    {
        if (string.IsNullOrEmpty(text))
        {
            return string.Empty;
        }

        return text
            .Replace("&", "&amp;")
            .Replace("<", "&lt;")
            .Replace(">", "&gt;")
            .Replace("\r\n", " ")
            .Replace("\n", " ")
            .Replace("\r", " ")
            .Trim();
    }

    /// <summary>
    /// Generates a standard auto-generated file header.
    /// </summary>
    /// <param name="sb">The StringBuilder to append to.</param>
    /// <param name="sourceUrl">Optional documentation source URL.</param>
    public static void GenerateFileHeader(StringBuilder sb, string? sourceUrl = null)
    {
        ArgumentNullException.ThrowIfNull(sb);

        sb.AppendLine("// <auto-generated>");
        sb.AppendLine($"// This file was generated by ModularPipelines.OptionsGenerator on {DateTime.UtcNow:yyyy-MM-dd}.");
        if (!string.IsNullOrEmpty(sourceUrl))
        {
            sb.AppendLine($"// Source: {sourceUrl}");
        }
        sb.AppendLine("// Do not edit this file manually.");
        sb.AppendLine("// </auto-generated>");
        sb.AppendLine();
    }

    /// <summary>
    /// Generates a standard auto-generated file header with nullable enable.
    /// </summary>
    public static void GenerateFileHeaderWithNullable(StringBuilder sb, string? sourceUrl = null)
    {
        GenerateFileHeader(sb, sourceUrl);
        sb.AppendLine("#nullable enable");
        sb.AppendLine();
    }
}
