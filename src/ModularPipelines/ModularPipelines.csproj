<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <ModularPipelineReadMeDescription>The base package for Modular Pipelines. This contains the framework for building, executing, controlling and reporting your modules.</ModularPipelineReadMeDescription>
  </PropertyGroup>
  <PropertyGroup>
    <Description>Write your pipelines in C#!</Description>
  </PropertyGroup>
  <!--
    InternalsVisibleTo Declarations
    ================================
    These declarations expose internal types to specific assemblies for legitimate purposes:

    Build System Integrations:
    - ModularPipelines.GitHub: Needs internal build system formatting/secret masking interfaces
    - ModularPipelines.Azure.Pipelines: Needs internal build system formatting/secret masking interfaces
    - ModularPipelines.TeamCity: Needs internal build system formatting/secret masking interfaces

    Test Assemblies:
    - ModularPipelines.UnitTests: Core framework tests requiring internal access
    - ModularPipelines.TestHelpers: Shared test utilities requiring internal access
    - ModularPipelines.Azure.UnitTests: Azure integration tests
    - ModularPipelines.AmazonWebServices.UnitTests: AWS integration tests

    Mocking Framework Support:
    - DynamicProxyGenAssembly2: Required by Moq/Castle.Core for creating proxies of internal types
  -->
  <ItemGroup>
    <!-- Build system integrations - access internal formatting/masking interfaces -->
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.GitHub</_Parameter1>
    </AssemblyAttribute>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.Azure.Pipelines</_Parameter1>
    </AssemblyAttribute>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.TeamCity</_Parameter1>
    </AssemblyAttribute>

    <!-- Test assemblies - verify internal behavior -->
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.UnitTests</_Parameter1>
    </AssemblyAttribute>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.TestHelpers</_Parameter1>
    </AssemblyAttribute>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.Azure.UnitTests</_Parameter1>
    </AssemblyAttribute>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.AmazonWebServices.UnitTests</_Parameter1>
    </AssemblyAttribute>
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>ModularPipelines.Distributed.UnitTests</_Parameter1>
    </AssemblyAttribute>

    <!-- Mocking framework support - required for Castle.Core/Moq -->
    <AssemblyAttribute Include="System.Runtime.CompilerServices.InternalsVisibleToAttribute">
      <_Parameter1>DynamicProxyGenAssembly2</_Parameter1>
    </AssemblyAttribute>
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="AsyncSemaphore" />
    <PackageReference Include="Mediator.Abstractions" />
    <PackageReference Include="Mediator.SourceGenerator">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
    </PackageReference>
    <PackageReference Include="Microsoft.Extensions.DependencyInjection" />
    <PackageReference Include="Microsoft.Extensions.Hosting" />
    <PackageReference Include="Microsoft.Extensions.Http" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="CliWrap" />
    <PackageReference Include="Polly" />
    <PackageReference Include="Spectre.Console" />
    <PackageReference Include="System.Text.Json" />
    <PackageReference Include="EnumerableAsyncProcessor" />
    <PackageReference Include="Initialization.Microsoft.Extensions.DependencyInjection" />
    <PackageReference Include="vertical-spectreconsolelogger" />
    <PackageReference Include="YamlDotNet" />
  </ItemGroup>
  <ItemGroup>
    <!-- Build analyzers (but don't apply them to this project - they're for consumers) -->
    <ProjectReference Include="..\ModularPipelines.Analyzers\ModularPipelines.Analyzers\ModularPipelines.Analyzers.csproj" ReferenceOutputAssembly="false" SetTargetFramework="TargetFramework=netstandard2.0" />
    <ProjectReference Include="..\ModularPipelines.Analyzers\ModularPipelines.Analyzers.CodeFixes\ModularPipelines.Analyzers.CodeFixes.csproj" ReferenceOutputAssembly="false" SetTargetFramework="TargetFramework=netstandard2.0" />
    <ProjectReference Include="..\ModularPipelines.SourceGenerator\ModularPipelines.SourceGenerator.csproj" ReferenceOutputAssembly="false" OutputItemType="Analyzer" SetTargetFramework="TargetFramework=netstandard2.0" />
  </ItemGroup>
  <!-- Include source generator and analyzers in NuGet package for consumers -->
  <PropertyGroup>
    <TargetsForTfmSpecificContentInPackage>$(TargetsForTfmSpecificContentInPackage);_AddSourceGeneratorToPackage</TargetsForTfmSpecificContentInPackage>
  </PropertyGroup>
  <Target Name="_AddSourceGeneratorToPackage">
    <ItemGroup>
      <!-- Source Generator -->
      <TfmSpecificPackageFile Include="$(MSBuildThisFileDirectory)..\ModularPipelines.SourceGenerator\bin\$(Configuration)\netstandard2.0\ModularPipelines.SourceGenerator.dll" PackagePath="analyzers/dotnet/cs" />
      <!-- Analyzers -->
      <TfmSpecificPackageFile Include="$(MSBuildThisFileDirectory)..\ModularPipelines.Analyzers\ModularPipelines.Analyzers\bin\$(Configuration)\netstandard2.0\ModularPipelines.Analyzers.dll" PackagePath="analyzers/dotnet/cs" />
      <TfmSpecificPackageFile Include="$(MSBuildThisFileDirectory)..\ModularPipelines.Analyzers\ModularPipelines.Analyzers.CodeFixes\bin\$(Configuration)\netstandard2.0\ModularPipelines.Analyzers.CodeFixes.dll" PackagePath="analyzers/dotnet/cs" />
    </ItemGroup>
  </Target>
</Project>