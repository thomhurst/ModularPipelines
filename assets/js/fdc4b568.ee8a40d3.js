"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9285],{4544:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>a,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"how-to/retry-policy","title":"Retry Policies","description":"When creating modules, you can set a retry policy per module using the Configure() method. The retry policy uses Polly, so if you\'ve used Polly before you should be familiar with how to use it.","source":"@site/docs/how-to/retry-policy.md","sourceDirName":"how-to","slug":"/how-to/retry-policy","permalink":"/ModularPipelines/docs/how-to/retry-policy","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Retry Policies","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Run conditions","permalink":"/ModularPipelines/docs/how-to/run-conditions"},"next":{"title":"Skipping Modules","permalink":"/ModularPipelines/docs/how-to/skipping"}}');var t=o(4848),r=o(8453);const l={title:"Retry Policies",sidebar_position:6},s="Retry Policies",c={},d=[{value:"Using ModuleConfiguration",id:"using-moduleconfiguration",level:2},{value:"Simple Retry Count",id:"simple-retry-count",level:3},{value:"Custom Polly Policy",id:"custom-polly-policy",level:3},{value:"Context-Aware Retry Policy",id:"context-aware-retry-policy",level:3},{value:"Combining with Other Behaviors",id:"combining-with-other-behaviors",level:2},{value:"Default Retry Policy",id:"default-retry-policy",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"retry-policies",children:"Retry Policies"})}),"\n",(0,t.jsxs)(n.p,{children:["When creating modules, you can set a retry policy per module using the ",(0,t.jsx)(n.code,{children:"Configure()"})," method. The retry policy uses Polly, so if you've used Polly before you should be familiar with how to use it."]}),"\n",(0,t.jsx)(n.h2,{id:"using-moduleconfiguration",children:"Using ModuleConfiguration"}),"\n",(0,t.jsx)(n.h3,{id:"simple-retry-count",children:"Simple Retry Count"}),"\n",(0,t.jsxs)(n.p,{children:["The easiest way to add retries is with ",(0,t.jsx)(n.code,{children:"WithRetryCount()"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public class MyModule : Module<CommandResult>\n{\n    protected override ModuleConfiguration Configure() => ModuleConfiguration.Create()\n        .WithRetryCount(3)  // Retry up to 3 times with exponential backoff\n        .Build();\n\n    protected override async Task<CommandResult?> ExecuteAsync(IModuleContext context, CancellationToken cancellationToken)\n    {\n        // Do something that might fail transiently\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"custom-polly-policy",children:"Custom Polly Policy"}),"\n",(0,t.jsx)(n.p,{children:"For more control, you can provide a custom Polly policy:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public class MyModule : Module<CommandResult>\n{\n    protected override ModuleConfiguration Configure() => ModuleConfiguration.Create()\n        .WithRetryPolicy(\n            Policy.Handle<HttpRequestException>()\n                .WaitAndRetryAsync(5, i => TimeSpan.FromSeconds(i * i)))\n        .Build();\n\n    protected override async Task<CommandResult?> ExecuteAsync(IModuleContext context, CancellationToken cancellationToken)\n    {\n        // Do something\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"context-aware-retry-policy",children:"Context-Aware Retry Policy"}),"\n",(0,t.jsx)(n.p,{children:"If you need access to the pipeline context when building your policy:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public class MyModule : Module<CommandResult>\n{\n    protected override ModuleConfiguration Configure() => ModuleConfiguration.Create()\n        .WithRetryPolicy(ctx =>\n        {\n            var retryCount = ctx.Environment.IsCI ? 5 : 2;\n            return Policy.Handle<Exception>()\n                .WaitAndRetryAsync(retryCount, i => TimeSpan.FromSeconds(i));\n        })\n        .Build();\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"combining-with-other-behaviors",children:"Combining with Other Behaviors"}),"\n",(0,t.jsx)(n.p,{children:"Retry policies can be combined with other module behaviors:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public class ResilientModule : Module<CommandResult>\n{\n    protected override ModuleConfiguration Configure() => ModuleConfiguration.Create()\n        .WithRetryCount(3)\n        .WithTimeout(TimeSpan.FromMinutes(10))\n        .WithIgnoreFailures()  // Don't fail the pipeline even after all retries\n        .Build();\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"default-retry-policy",children:"Default Retry Policy"}),"\n",(0,t.jsxs)(n.p,{children:["Retry policies are off by default. You can set a default retry count on the ",(0,t.jsx)(n.code,{children:"PipelineOptions"})," when using the ",(0,t.jsx)(n.code,{children:"PipelineHostBuilder"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"await PipelineHostBuilder.Create()\n    .AddModule<Module1>()\n    .AddModule<Module2>()\n    .AddModule<Module3>()\n    .ConfigurePipelineOptions((context, options) =>\n    {\n        options.DefaultRetryCount = 3;\n    })\n    .ExecutePipelineAsync();\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This applies to all modules that don't override their retry policy. Modules can override this default by configuring their own retry policy in ",(0,t.jsx)(n.code,{children:"Configure()"}),"."]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>s});var i=o(6540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);