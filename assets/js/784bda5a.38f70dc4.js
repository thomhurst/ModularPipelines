"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[791],{2448:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"how-to/sub-modules","title":"Sub-Modules","description":"What are they?","source":"@site/docs/how-to/sub-modules.md","sourceDirName":"how-to","slug":"/how-to/sub-modules","permalink":"/ModularPipelines/docs/how-to/sub-modules","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Sub-Modules"},"sidebar":"tutorialSidebar","previous":{"title":"Module History","permalink":"/ModularPipelines/docs/how-to/storing-and-retrieving-results"},"next":{"title":"Time Estimator","permalink":"/ModularPipelines/docs/how-to/time-estimator"}}');var a=t(4848),s=t(8453);const r={title:"Sub-Modules"},i="Sub-Modules",c={},l=[{value:"What are they?",id:"what-are-they",level:2},{value:"Example",id:"example",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"sub-modules",children:"Sub-Modules"})}),"\n",(0,a.jsx)(n.h2,{id:"what-are-they",children:"What are they?"}),"\n",(0,a.jsx)(n.p,{children:"Sub-modules are ways to track and organise blocks of execution where it doesn't make sense to refactor into its own module. This might be when you're iterating through data in a loop."}),"\n",(0,a.jsx)(n.p,{children:"For instance, you have 10 .NET projects to package into NuGet packages."}),"\n",(0,a.jsx)(n.p,{children:"By looping through them and declaring each one within their own submodule, then we can easily track failures, and the console progress dialog will show time taken for each submodules."}),"\n",(0,a.jsx)(n.p,{children:"A submodule takes two arguments: A name, and the code it should execute."}),"\n",(0,a.jsx)(n.p,{children:"If a submodule fails, it'll throw an exception with the name provided, making it easier to track what specifically failed."}),"\n",(0,a.jsx)(n.p,{children:"In the example below, we use the .csproj filename as the submodule name. So if one of our projects failed to pack, we'd know which one by the exception message."}),"\n",(0,a.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'public class PackProjectsModule : Module<CommandResult[]>\n{\n    protected override async Task<CommandResult[]?> ExecuteAsync(IPipelineContext context, CancellationToken cancellationToken)\n    {\n        var packageVersion = await GetModule<NugetVersionGeneratorModule>();\n\n        var projects = context.Git().RootDirectory\n            .GetFiles(x =>\n                x.Extension == ".csproj" && !x.Name.Contains("test", StringComparison.InvariantCultureIgnoreCase))\n            .ToList();\n\n        return await PackProjects(context, projects, packageVersion.Value, cancellationToken).ToArrayAsync(cancellationToken: cancellationToken);\n    }\n\n    private async IAsyncEnumerable<CommandResult> PackProjects(IPipelineContext context, List<File> projects, string? packageVersion, [EnumeratorCancellation] CancellationToken cancellationToken)\n    {\n        foreach (var project in projects)\n        {\n            yield return await SubModule(project.Name, () => context.DotNet().Pack(new DotNetPackOptions\n            {\n                TargetPath = project,\n                Configuration = Configuration.Release,\n                Properties = new List<string>\n                {\n                    $"PackageVersion={packageVersion}",\n                    $"Version={packageVersion}",\n                },\n            }, cancellationToken));\n        }\n    }\n}\n'})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var o=t(6540);const a={},s=o.createContext(a);function r(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),o.createElement(s.Provider,{value:n},e.children)}}}]);