"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3179],{3187:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>x,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"how-to/migrating-to-v2-context","title":"Migrating to v2 Context API","description":"ModularPipelines v2 introduces a role-based context architecture that organizes functionality into domain-specific interfaces. This provides better discoverability, cleaner separation of concerns, and improved IntelliSense support.","source":"@site/docs/how-to/migrating-to-v2-context.md","sourceDirName":"how-to","slug":"/how-to/migrating-to-v2-context","permalink":"/ModularPipelines/docs/how-to/migrating-to-v2-context","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Migrating to v2 Context API"},"sidebar":"tutorialSidebar","previous":{"title":"Inheriting","permalink":"/ModularPipelines/docs/how-to/inheriting"},"next":{"title":"Migrating to v2 CommandLineToolOptions","permalink":"/ModularPipelines/docs/how-to/migrating-to-v2-options"}}');var c=t(4848),r=t(8453);const s={title:"Migrating to v2 Context API"},o="Migrating to v2 Context API",d={},l=[{value:"What&#39;s Changed",id:"whats-changed",level:2},{value:"Role-Based Domain Contexts",id:"role-based-domain-contexts",level:3},{value:"New Interface Hierarchy",id:"new-interface-hierarchy",level:3},{value:"Removed Interfaces",id:"removed-interfaces",level:3},{value:"Migration Steps",id:"migration-steps",level:2},{value:"1. Update Property Access Paths",id:"1-update-property-access-paths",level:3},{value:"2. Special Folder Access",id:"2-special-folder-access",level:3},{value:"3. Update Type References",id:"3-update-type-references",level:3},{value:"For Extension Authors",id:"for-extension-authors",level:2},{value:"Update Extension Method Signatures",id:"update-extension-method-signatures",level:3},{value:"Benefits",id:"benefits",level:2},{value:"Backward Compatibility",id:"backward-compatibility",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"migrating-to-v2-context-api",children:"Migrating to v2 Context API"})}),"\n",(0,c.jsx)(n.p,{children:"ModularPipelines v2 introduces a role-based context architecture that organizes functionality into domain-specific interfaces. This provides better discoverability, cleaner separation of concerns, and improved IntelliSense support."}),"\n",(0,c.jsx)(n.h2,{id:"whats-changed",children:"What's Changed"}),"\n",(0,c.jsx)(n.h3,{id:"role-based-domain-contexts",children:"Role-Based Domain Contexts"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Before (v1):"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'// Flat hierarchy with many properties directly on context\ncontext.Command.ExecuteCommandLineTool(options);\ncontext.Bash.Command("echo hello");\ncontext.FileSystem.GetFile("/path/to/file");\ncontext.Environment.EnvironmentVariables["PATH"];\ncontext.Hasher.Hash(data, HashAlgorithmName.SHA256);\n'})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"After (v2):"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'// Domain-organized hierarchy\ncontext.Shell.Command.ExecuteCommandLineTool(options);\ncontext.Shell.Bash.Command("echo hello");\ncontext.Files.GetFile("/path/to/file");\ncontext.Environment.Variables["PATH"];\ncontext.Security.Hasher.Hash(data, HashAlgorithmName.SHA256);\n'})}),"\n",(0,c.jsx)(n.h3,{id:"new-interface-hierarchy",children:"New Interface Hierarchy"}),"\n",(0,c.jsx)(n.p,{children:"The v2 context API introduces domain-specific interfaces accessible through properties:"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"v1 Access Pattern"}),(0,c.jsx)(n.th,{children:"v2 Access Pattern"}),(0,c.jsx)(n.th,{children:"Domain Interface"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Command"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Shell.Command"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IShellContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Bash"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Shell.Bash"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IShellContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.PowerShell"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Shell.PowerShell"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IShellContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.FileSystem"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Files"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IFilesContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Zip"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Files.Zip"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IFilesContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Base64"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Data.Base64"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IDataContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Hex"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Data.Hex"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IDataContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Json"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Data.Json"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IDataContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Xml"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Data.Xml"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IDataContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Yaml"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Data.Yaml"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IDataContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Environment.EnvironmentVariables"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Environment.Variables"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IEnvironmentDomainContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Hasher"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Security.Hasher"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"ISecurityContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Encryptor"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Security.Encryptor"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"ISecurityContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.NuGet"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Installers.NuGet"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"IInstallersContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Downloader"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Network.Downloader"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"INetworkContext"})})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Http"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"context.Network.Http"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"INetworkContext"})})]})]})]}),"\n",(0,c.jsx)(n.h3,{id:"removed-interfaces",children:"Removed Interfaces"}),"\n",(0,c.jsx)(n.p,{children:"The following facade interfaces have been removed in v2:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"IPipelineServices"})," - Use ",(0,c.jsx)(n.code,{children:"context.Services"})," directly"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"IPipelineLogging"})," - Use ",(0,c.jsx)(n.code,{children:"context.Logger"})," directly"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"IPipelineTools"})," - Use domain contexts"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"IPipelineEncoding"})," - Use ",(0,c.jsx)(n.code,{children:"context.Data"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"IPipelineFileSystem"})," - Use ",(0,c.jsx)(n.code,{children:"context.Files"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"IPipelineEnvironment"})," - Use ",(0,c.jsx)(n.code,{children:"context.Environment"})]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"migration-steps",children:"Migration Steps"}),"\n",(0,c.jsx)(n.h3,{id:"1-update-property-access-paths",children:"1. Update Property Access Paths"}),"\n",(0,c.jsx)(n.p,{children:"Use find-and-replace to update access patterns:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"// Shell operations\ncontext.Command \u2192 context.Shell.Command\ncontext.Bash \u2192 context.Shell.Bash\ncontext.PowerShell \u2192 context.Shell.PowerShell\n\n// File operations\ncontext.FileSystem \u2192 context.Files\ncontext.FileSystem.GetFolder(SpecialFolder) \u2192 context.Files.GetFolder(SpecialFolder)\ncontext.Zip \u2192 context.Files.Zip\n\n// Data operations\ncontext.Base64 \u2192 context.Data.Base64\ncontext.Hex \u2192 context.Data.Hex\ncontext.Json \u2192 context.Data.Json\ncontext.Xml \u2192 context.Data.Xml\ncontext.Yaml \u2192 context.Data.Yaml\n\n// Security operations\ncontext.Hasher \u2192 context.Security.Hasher\ncontext.Encryptor \u2192 context.Security.Encryptor\n\n// Environment operations\ncontext.Environment.EnvironmentVariables \u2192 context.Environment.Variables\n\n// Installer operations\ncontext.NuGet \u2192 context.Installers.NuGet\n\n// Network operations\ncontext.Downloader \u2192 context.Network.Downloader\ncontext.Http \u2192 context.Network.Http\n"})}),"\n",(0,c.jsx)(n.h3,{id:"2-special-folder-access",children:"2. Special Folder Access"}),"\n",(0,c.jsxs)(n.p,{children:["The ",(0,c.jsx)(n.code,{children:"GetFolder(Environment.SpecialFolder)"})," overload is available on the ",(0,c.jsx)(n.code,{children:"Files"})," domain:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"// Before (v1)\nvar appData = context.FileSystem.GetFolder(Environment.SpecialFolder.ApplicationData);\n\n// After (v2)\nvar appData = context.Files.GetFolder(Environment.SpecialFolder.ApplicationData);\n"})}),"\n",(0,c.jsx)(n.h3,{id:"3-update-type-references",children:"3. Update Type References"}),"\n",(0,c.jsx)(n.p,{children:"If you referenced the removed facade interfaces directly, update to the new types:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"// Before\nIPipelineServices services = context.ServiceProvider;\nIPipelineFileSystem fs = context.FileSystem;\n\n// After\nIServicesContext services = context.Services;\nIFilesContext files = context.Files;\n"})}),"\n",(0,c.jsx)(n.h2,{id:"for-extension-authors",children:"For Extension Authors"}),"\n",(0,c.jsx)(n.p,{children:"If you maintain a ModularPipelines extension package, additional changes are required:"}),"\n",(0,c.jsx)(n.h3,{id:"update-extension-method-signatures",children:"Update Extension Method Signatures"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Before (v1):"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.Extensions.DependencyInjection;\n\npublic static class MyToolExtensions\n{\n    public static IMyTool MyTool(this IPipelineHookContext context)\n    {\n        return context.ServiceProvider.GetRequiredService<IMyTool>();\n    }\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"After (v2):"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"public static class MyToolExtensions\n{\n    public static IMyTool MyTool(this IPipelineContext context)\n    {\n        return context.Services.Get<IMyTool>();\n    }\n}\n"})}),"\n",(0,c.jsx)(n.p,{children:"Key changes:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"IPipelineHookContext"})," \u2192 ",(0,c.jsx)(n.code,{children:"IPipelineContext"})]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"context.ServiceProvider.GetRequiredService<T>()"})," \u2192 ",(0,c.jsx)(n.code,{children:"context.Services.Get<T>()"})]}),"\n",(0,c.jsxs)(n.li,{children:["Remove ",(0,c.jsx)(n.code,{children:"using Microsoft.Extensions.DependencyInjection;"})," if only used for ",(0,c.jsx)(n.code,{children:"GetRequiredService"})]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"benefits",children:"Benefits"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Discoverability"}),": IntelliSense guides you through domain-specific functionality"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Separation of Concerns"}),": Each domain context has a single responsibility"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Reduced Surface Area"}),": Cleaner API with fewer top-level properties"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Extension-Friendly"}),": ",(0,c.jsx)(n.code,{children:"IPipelineContext"})," provides stable extension point"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"Type Safety"}),": Domain interfaces provide strong typing for each capability area"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"backward-compatibility",children:"Backward Compatibility"}),"\n",(0,c.jsxs)(n.p,{children:["This is a breaking change. The v1 facade interfaces (",(0,c.jsx)(n.code,{children:"IPipelineServices"}),", ",(0,c.jsx)(n.code,{children:"IPipelineTools"}),", etc.) have been removed. Code using these interfaces must be updated to use the new domain contexts."]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(6540);const c={},r=i.createContext(c);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);