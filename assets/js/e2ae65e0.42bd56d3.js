"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[9664],{3801:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"how-to/defining-modules","title":"Defining Modules","description":"Defining Modules","source":"@site/docs/how-to/defining-modules.md","sourceDirName":"how-to","slug":"/how-to/defining-modules","permalink":"/ModularPipelines/docs/how-to/defining-modules","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Defining Modules","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Pipeline Host","permalink":"/ModularPipelines/docs/how-to/pipeline-host"},"next":{"title":"Execution and Dependencies","permalink":"/ModularPipelines/docs/how-to/execution-and-dependencies"}}');var t=i(4848),l=i(8453);const s={title:"Defining Modules",sidebar_position:2},r=void 0,c={},d=[{value:"Defining Modules",id:"defining-modules",level:2},{value:"Configuring Module Behavior",id:"configuring-module-behavior",level:2},{value:"Available Configuration Options",id:"available-configuration-options",level:3},{value:"Lifecycle Hooks",id:"lifecycle-hooks",level:2},{value:"Tags and Categories",id:"tags-and-categories",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"defining-modules",children:"Defining Modules"}),"\n",(0,t.jsxs)(n.p,{children:["Modules are defined by creating a class that inherits from the ",(0,t.jsx)(n.code,{children:"Module<T>"})," base class."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"T"})," is the type of object that your Module will return, and that object can be seen by other Modules (if they depend on it)."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public class FindAFileModule : Module<FileInfo>\n{\n    protected override async Task<FileInfo?> ExecuteAsync(\n        IModuleContext context, CancellationToken cancellationToken)\n    {\n        return context.FileSystem\n            .GetFiles("C:\\\\", SearchOption.AllDirectories, file => file.Name == "MyJsonFile.json")\n            .Single();\n    }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["You can also return ",(0,t.jsx)(n.code,{children:"null"})," if your module doesn't need to return data:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public class CleanupModule : Module<bool>\n{\n    protected override async Task<bool?> ExecuteAsync(\n        IModuleContext context, CancellationToken cancellationToken)\n    {\n        await context.FileSystem.DeleteDirectoryAsync("./temp");\n        return true;\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuring-module-behavior",children:"Configuring Module Behavior"}),"\n",(0,t.jsxs)(n.p,{children:["Configure module behaviors such as timeouts, retry policies, skip conditions, and hooks by overriding the ",(0,t.jsx)(n.code,{children:"Configure()"})," method:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public class MyModule : Module<FileInfo>\n{\n    protected override ModuleConfiguration Configure() => ModuleConfiguration.Create()\n        .WithTimeout(TimeSpan.FromMinutes(5))\n        .WithRetryCount(3)\n        .WithSkipWhen(() => !File.Exists("important.json"))\n        .WithIgnoreFailures()\n        .WithAlwaysRun()\n        .Build();\n\n    protected override async Task<FileInfo?> ExecuteAsync(\n        IModuleContext context, CancellationToken cancellationToken)\n    {\n        // Module logic here\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"available-configuration-options",children:"Available Configuration Options"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithTimeout(TimeSpan)"})}),(0,t.jsx)(n.td,{children:"Maximum execution time before module is cancelled"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithRetryCount(int)"})}),(0,t.jsx)(n.td,{children:"Number of retry attempts on failure"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithRetryPolicy(IAsyncPolicy)"})}),(0,t.jsx)(n.td,{children:"Custom Polly retry policy"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithSkipWhen(...)"})}),(0,t.jsx)(n.td,{children:"Condition to skip the module"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithIgnoreFailures()"})}),(0,t.jsx)(n.td,{children:"Don't fail the pipeline if this module fails"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithIgnoreFailuresWhen(...)"})}),(0,t.jsx)(n.td,{children:"Conditionally ignore failures"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithAlwaysRun()"})}),(0,t.jsx)(n.td,{children:"Run even if the pipeline has failed"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithBeforeExecute(...)"})}),(0,t.jsx)(n.td,{children:"Hook to run before execution"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:".WithAfterExecute(...)"})}),(0,t.jsx)(n.td,{children:"Hook to run after execution"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"lifecycle-hooks",children:"Lifecycle Hooks"}),"\n",(0,t.jsx)(n.p,{children:"You can also override lifecycle methods directly on the module class:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public class MyModule : Module<string>\n{\n    protected override Task OnBeforeExecuteAsync(\n        IModuleContext context, CancellationToken cancellationToken)\n    {\n        context.Logger.LogInformation("Starting module execution");\n        return Task.CompletedTask;\n    }\n\n    protected override Task<ModuleResult<string>?> OnAfterExecuteAsync(\n        IModuleContext context,\n        ModuleResult<string> result,\n        CancellationToken cancellationToken)\n    {\n        context.Logger.LogInformation("Module completed with status: {Status}", result.ModuleStatus);\n        return Task.FromResult<ModuleResult<string>?>(null);\n    }\n\n    protected override Task OnSkippedAsync(\n        IModuleContext context,\n        SkipDecision skipDecision,\n        CancellationToken cancellationToken)\n    {\n        context.Logger.LogWarning("Module skipped: {Reason}", skipDecision.Reason);\n        return Task.CompletedTask;\n    }\n\n    protected override Task OnFailedAsync(\n        IModuleContext context,\n        Exception exception,\n        CancellationToken cancellationToken)\n    {\n        context.Logger.LogError(exception, "Module failed");\n        return Task.CompletedTask;\n    }\n\n    protected override async Task<string?> ExecuteAsync(\n        IModuleContext context, CancellationToken cancellationToken)\n    {\n        return "result";\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"tags-and-categories",children:"Tags and Categories"}),"\n",(0,t.jsx)(n.p,{children:"Organize your modules with tags and categories:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'[ModuleCategory("Build")]\n[ModuleTag("critical")]\n[ModuleTag("fast")]\npublic class BuildModule : Module<BuildOutput>\n{\n    protected override async Task<BuildOutput?> ExecuteAsync(\n        IModuleContext context, CancellationToken cancellationToken)\n    {\n        // ...\n    }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Or define them programmatically:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public class BuildModule : Module<BuildOutput>\n{\n    public override string? Category => "Build";\n    public override IReadOnlySet<string> Tags => new HashSet<string> { "critical", "fast" };\n\n    protected override async Task<BuildOutput?> ExecuteAsync(\n        IModuleContext context, CancellationToken cancellationToken)\n    {\n        // ...\n    }\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"See the individual documentation pages for more details on each behavior:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"skipping",children:"Skipping Modules"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"retry-policy",children:"Retry Policies"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"timeouts",children:"Timeouts"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"ignoring-failures",children:"Ignoring Failures"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"always-run",children:"Always Run"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"hooks",children:"Hooks"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"categories",children:"Categories"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"run-conditions",children:"Run Conditions"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>r});var o=i(6540);const t={},l=o.createContext(t);function s(e){const n=o.useContext(l);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(l.Provider,{value:n},e.children)}}}]);